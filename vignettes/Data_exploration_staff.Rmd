---
title: "Data exploration (staff)"
output: 
  rmarkdown::html_document:
    df_print: paged
    toc: true
    toc_depth: 3
    toc_float:
      collapsed: false
    code_folding: hide
vignette: >
  %\VignetteIndexEntry{Data_exploration_staff}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, message=FALSE}
library(rangeR)
library(dplyr)
library(tibble)
library(ggplot2)
library(forcats)
```

## Data completeness

Here is a plot showing the breakdown of the number of countries for which we retrieved the number of rangers:

```{r completness_rangers computation}
completness_rangers <- tibble(
  Category = c("countries for which the numbers for rangers and other staffs are both separately known",
               "countries for which the numbers for rangers and other staffs are both known but undistinguishable",
               "countries for which only the number for rangers is known (other staff missing)",
               "countries for which we have no specific information about rangers"),
  N = c(sum(!is.na(data_rangers$staff_rangers_others_known)),
        sum(!is.na(data_rangers$staff_total_details_unknown)),
        sum(!is.na(data_rangers$staff_rangers_others_unknown)),
        sum((is.na(data_rangers$staff_rangers_others_known) &
             is.na(data_rangers$staff_rangers_others_unknown) &
             is.na(data_rangers$staff_total_details_unknown)))
        ))
```

```{r completness_rangers pie}
ggplot(completness_rangers) +
  aes(x = "", y = N, fill = Category, label = N) +
  geom_bar(stat = "identity") +
  geom_text(position = position_stack(vjust = 0.5)) +
  coord_polar("y", start = 0) +
  theme_void() +
  theme(legend.position = "top") +
  guides(fill = guide_legend(nrow = 4, byrow = TRUE)) +
  labs(fill = "")
```

**Note**: so far the numbers don't add up due to a data issue with Kenya...

The countries for which we miss the information are the following ones (ordered by decreasing country area):
```{r completness_rangers list}
data_rangers %>%
  filter(is.na(staff_rangers_others_known) &
          is.na(staff_rangers_others_unknown) &
          is.na(staff_total_details_unknown)) %>%
  arrange(desc(area_country))
```


## Distribution

Here are the countries sorted by number of rangers (mind the log scale):

```{r distribution rangers plot, fig.height=20}
data_rangers %>%
  filter(!is.na(staff_rangers)) %>%
  mutate(countryname_eng = fct_reorder(countryname_eng, staff_rangers)) %>%
  ggplot() +
    aes(x = staff_rangers, y = countryname_eng, fill = country_UN_continent) +
    geom_col(alpha = 0.5) +
    coord_trans(x = "log1p", expand = FALSE) +
    theme_minimal() +
    scale_x_continuous(breaks = c(0, 10, 100, 1000, 10000), minor_breaks = NULL) +
    labs(y = "Country", x = "Number of rangers") +
    theme(legend.position = "none", panel.grid.major.y = element_blank())
```


```{r distribution rangers stats}

```

